import{g as n}from"./storage-15de54d1.js";function a(e){return!!(e&&!e.startsWith("chrome://")&&!e.startsWith("edge://")&&!e.startsWith("chrome-extension://")&&!e.startsWith("about:"))}async function s(e,r){if(a(r))try{const t=await n(r);try{t?chrome.tabs.sendMessage(e,{type:"SHOW_NOTE_OVERLAY",note:t.note}):chrome.tabs.sendMessage(e,{type:"SHOW_INTENT_PROMPT"})}catch(o){console.error("Error sending message to tab:",o)}}catch(t){console.error("Error checking for notes:",t)}}chrome.tabs.onActivated.addListener(async e=>{try{const r=await chrome.tabs.get(e.tabId);r.url&&setTimeout(()=>s(e.tabId,r.url),1500)}catch(r){console.error("Error in tab activation:",r)}});chrome.tabs.onUpdated.addListener(async(e,r,t)=>{r.status==="complete"&&t.url&&setTimeout(()=>s(e,t.url),1500)});chrome.runtime.onMessage.addListener((e,r,t)=>{if(e.type==="OPEN_POPUP")try{chrome.action.openPopup().catch(o=>{console.error("Failed to open popup:",o)}),t({success:!0})}catch(o){console.error("Error opening popup:",o),t({success:!1,error:o instanceof Error?o.message:"Unknown error"})}return!0});
